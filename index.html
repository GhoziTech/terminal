<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:,">
    <title>Sistem Pemrosesan Data OSINT V7</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Tone.js for sound effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Nova+Mono&display=swap');

        body {
            font-family: 'Nova Mono', monospace;
            /* Font for terminal look */
            background-color: #000;
            color: #0f0;
            /* Neon green */
            overflow-x: hidden;
            cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'><circle cx='8' cy='8' r='7' fill='none' stroke='%230f0' stroke-width='1.5'/><line x1='8' y1='1' x2='8' y2='15' stroke='%230f0' stroke-width='1.5'/><line x1='1' y1='8' x2='15' y2='8' stroke='%230f0' stroke-width='1.5'/></svg>") 8 8, auto;
        }

        .terminal-container {
            min-height: 100vh;
            padding: 1rem;
        }

        .terminal-line::before {
            content: '$ ';
            color: #0ff;
            /* Cyan for prompt */
        }

        .text-neon {
            text-shadow: 0 0 5px #0f0, 0 0 10px #0f0, 0 0 15px #0f0;
        }

        .typing-cursor {
            display: inline-block;
            width: 8px;
            height: 1rem;
            background-color: #0f0;
            animation: blink 1s step-end infinite;
            margin-left: 2px;
        }

        @keyframes blink {

            from,
            to {
                opacity: 0;
            }

            50% {
                opacity: 1;
            }
        }

        .censored {
            color: #ff0000;
            /* Red for censored text */
            filter: blur(2px);
            user-select: none;
            cursor: default;
        }

        /* Custom scrollbar for terminal look */
        .terminal-output::-webkit-scrollbar {
            width: 8px;
        }

        .terminal-output::-webkit-scrollbar-track {
            background: #111;
        }

        .terminal-output::-webkit-scrollbar-thumb {
            background: #0f0;
            border-radius: 4px;
        }

        .user-id-display {
            background-color: #1a1a1a;
            border: 1px dashed #0ff;
            padding: 8px;
            word-break: break-all;
            font-size: 0.8rem;
        }

        .professional-h1 {
            /* Fixes cramped mobile header by ensuring proper spacing */
            display: flex;
            align-items: center;
            gap: 8px;
            /* Spacing between [INIT] and title */
            flex-wrap: wrap;
        }
    </style>
</head>

<body>

    <!-- Simulated Message Box for Payment Success/Error (Replaces alert()) -->
    <div id="messageBox" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden">
        <div class="bg-gray-900 p-6 rounded-lg border-2 border-green-500 shadow-neon max-w-lg w-full text-center">
            <h3 id="messageTitle" class="text-xl font-bold mb-3 text-neon"></h3>
            <p id="messageText" class="text-gray-300 mb-4"></p>

            <!-- Action buttons -->
            <div id="messageActions" class="flex justify-center space-x-4">
                <button id="closeMessageBox"
                    class="bg-green-600 text-black font-bold py-2 px-6 rounded-md hover:bg-green-400 transition duration-300">
                    [$ CLOSE]
                </button>
            </div>
        </div>
    </div>

    <div class="terminal-container container mx-auto p-4 md:p-8">

        <!-- Header dan User ID Display -->
        <div class="flex justify-between items-center mb-6 border-b border-green-700 pb-2">
            <h1 class="text-2xl md:text-3xl text-neon professional-h1">
                <!-- Menjamin spasi yang baik -->
                [<span class="text-cyan-500">INIT</span>] <span class="text-white">OSINT CONSOLE V7.2</span>
                <!-- Premium Badge -->
                <span id="premiumBadge"
                    class="hidden text-xs bg-yellow-600 text-black font-bold px-2 py-0.5 rounded-full shadow-md shadow-yellow-600/50">ALPHA-7
                    ACTIVE</span>
            </h1>
            <div class="flex flex-col items-end text-right">
                <span class="text-xs text-gray-500">User ID (Konfirmasi Admin):</span>
                <span id="displayUserId" class="text-sm text-yellow-500 font-bold break-all">Memuat...</span>
            </div>
            <div class="flex items-center space-x-2 hidden md:flex">
                <span class="text-sm">SOUND</span>
                <input type="checkbox" id="soundToggle" class="hidden" checked>
                <label for="soundToggle" class="cursor-pointer">
                    <div id="soundIndicator"
                        class="w-10 h-6 flex items-center rounded-full p-1 transition duration-200 bg-green-500">
                        <div
                            class="toggle-circle w-4 h-4 rounded-full bg-black shadow-md transform transition duration-200 translate-x-3">
                        </div>
                    </div>
                </label>
            </div>
        </div>

        <!-- Admin Verification Panel -->
        <div id="adminPanel"
            class="mt-4 mb-8 p-6 bg-red-900/70 border border-red-600 rounded-lg shadow-2xl shadow-red-700/50 hidden">
            <h2 class="text-xl font-bold text-white mb-3 text-center">[[ ADMIN VERIFICATION PANEL ]]</h2>
            <p class="text-sm text-yellow-400 mb-4 text-center">Mode Admin Aktif. Masukkan User ID member yang telah
                membayar untuk mengaktifkan status Premium.</p>

            <div class="flex flex-col md:flex-row gap-4 items-center">
                <input type="text" id="targetUserIdInput"
                    placeholder="Masukkan Target User ID (Dari Konfirmasi Telegram)"
                    class="flex-grow bg-black border border-red-600 text-white p-3 rounded-md focus:ring-red-500 focus:border-red-500">
                <button id="activatePremiumButton"
                    class="bg-red-600 text-black font-bold p-3 rounded-md hover:bg-red-400 transition duration-300 shadow-neon w-full md:w-auto">
                    [$ RUN] AKTIVASI ALPHA-7
                </button>
            </div>
            <p id="adminStatus" class="text-yellow-400 mt-2 text-sm hidden">Status: </p>
        </div>

        <!-- Area Input Pencarian -->
        <div id="input-section" class="mb-8 p-4 border border-green-600 rounded-lg bg-gray-900/50">
            <h2 class="text-xl mb-4 text-neon">[$ COMMAND] Masukkan Kueri Target Data</h2>
            <div class="flex flex-col md:flex-row gap-4">
                <select id="searchType"
                    class="bg-black border border-green-600 text-neon p-3 rounded-md focus:ring-green-500 focus:border-green-500 w-full md:w-1/3">
                    <option value="nama" class="bg-gray-800">Nama Lengkap / Panggilan</option>
                    <option value="nomor_hp" class="bg-gray-800">Nomor HP / WhatsApp</option>
                    <option value="email" class="bg-gray-800">Alamat Email / Username Sosmed</option>
                    <option value="ip" class="bg-gray-800">Alamat IP / IMEI</option>
                    <option value="plat" class="bg-gray-800">Plat Kendaraan (Doxing)</option>
                    <option value="nik" class="bg-gray-800">NIK KTP / Data Kependudukan</option>
                </select>
                <input type="text" id="targetInput" placeholder="Contoh: Budi Santoso / +6281xxxxxxxx"
                    class="flex-grow bg-black border border-green-600 text-neon p-3 rounded-md focus:ring-green-500 focus:border-green-500">
                <button id="searchButton"
                    class="bg-green-600 text-black font-bold p-3 rounded-md hover:bg-green-400 transition duration-300 shadow-neon">
                    [$ RUN] EKSEKUSI DATA
                </button>
            </div>
            <!-- Error Message -->
            <div id="error-message" class="text-red-500 mt-2 p-2 border border-red-700 bg-red-900/20 rounded-md hidden">
                [$ ERROR] Input Kueri Wajib Diisi. Periksa Parameter!
            </div>
        </div>

        <!-- Area Output Terminal -->
        <div id="terminalOutput"
            class="terminal-output bg-black p-4 md:p-6 border border-green-700 h-96 overflow-y-auto rounded-lg text-sm md:text-base">
            <!-- Pesan awal -->
            <p>[$ SYSTEM] <span class="text-cyan-500">Menganalisis protokol keamanan... OK</span></p>
            <p>[$ SYSTEM] Memuat modul Kriptografi ELINT V4.2...</p>
            <p id="authStatusLine">[$ SYSTEM] <span class="text-yellow-500">Mengautentikasi sistem...</span></p>
        </div>

        <!-- Premium Section (Perjelas perbedaan fitur) -->
        <div id="premiumSection"
            class="mt-8 p-6 bg-gray-900/70 border border-green-900 rounded-lg shadow-2xl shadow-green-900/50">
            <h2 class="text-2xl font-bold text-neon mb-3 text-center">[[ AKSES VIP: PROTOKOL ALPHA-7 ]]</h2>
            <div class="md:flex md:space-x-8 space-y-4 md:space-y-0">
                <div class="md:w-1/2">
                    <p class="text-sm text-gray-400 mb-4">Akses **Alpha-7** memberikan fitur *high-priority* dan detail
                        data yang lebih dalam:</p>
                    <ul class="space-y-2 text-neon text-sm">
                        <li><span class="text-cyan-400">-></span> **Laju Prioritas:** Proses pencarian **dipercepat 80%**
                            (1-5 Detik), bukan 5 Menit.</li>
                        <li><span class="text-cyan-400">-></span> **Kedalaman Data (L6):** Sensor *Plat Kendaraan* dan
                            *Alamat Kantor* akan dikurangi (Layer 6).</li>
                        <li><span class="text-cyan-400">-></span> **Pencarian Massal:** Fitur kueri multipel (hingga 5
                            target sekaligus).</li>
                    </ul>
                    <p class="text-red-500 text-xs mt-3">**STATUS SAAT INI:** <span class="font-bold"
                            id="currentStatusText">NON-AKTIF (Member Biasa)</span></p>
                </div>
                <div class="md:w-1/2 flex flex-col justify-center items-center">
                    <p class="text-3xl font-extrabold text-white mb-2">Rp 399.000,-</p>
                    <p class="text-yellow-400 mb-4">/ Lisensi Bulanan</p>
                    <button id="premiumButton"
                        class="bg-red-700 text-white font-bold py-3 px-8 rounded-full hover:bg-red-500 transition duration-300 shadow-lg shadow-red-700/50">
                        AKTIFKAN ALPHA-7 (QRIS & Admin Confirm)
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer/Disclaimer Kecil (Safety Policy Compliance) -->
        <div class="mt-8 text-center text-xs text-gray-800">
            <p>Data Fiksional. Konten ini untuk tujuan Hiburan & Edukasi Simulasi Saja. Semua informasi disensor ketat.
            </p>
        </div>
    </div>

    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, setPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // =========================================================================
        // PERHATIAN: PENGATURAN FIREBASE UNTUK STANDALONE DEPLOYMENT (Vercel/Lainnya)
        // GANTI KONFIGURASI DI BAWAH INI DENGAN DATA PROYEK FIREBASE ANDA!
        // =========================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyBNnm6-JyV5Pg0hguJlWLjr3xc8Puvdo8k", // GANTI DENGAN API KEY ANDA
            authDomain: "osint-303f5.firebaseapp.com", // GANTI
            projectId: "osint-303f5", // GANTI
            storageBucket: "osint-303f5.firebasestorage.app", // GANTI
            messagingSenderId: "999796684833", // GANTI
            appId: "1:999796684833:web:38dbc1f9845362be524b60", // GANTI
        };

        // Ganti dengan ID Proyek yang Anda gunakan untuk Firestore di path 'artifacts'
        const appId = 'osint-v7-vercel';

        // JANGAN LUPA GANTI INI DENGAN USER ID ADMIN ANDA SENDIRI! (ID ini harus sama dengan yang di Firestore Rules)
        const ADMIN_USER_ID = "nBadP3HW7pZNrF8vzQlTZY3Xwyj1";

        // --- Global State ---
        let db;
        let auth;
        let userId = 'USER_ID_BELUM_SIAP';
        let isPremium = false;
        let unsubscribePremiumStatus = () => { };

        // Helper untuk Path Firestore
        // Path Firestore yang digunakan: artifacts/{appId}/public/data/premium_status/{uid}
        const getPremiumStatusPath = (uid) => doc(db, 'artifacts', appId, 'public', 'data', 'premium_status', uid);

        // --- Firebase & Auth Initialization (Dibuat Robust) ---
        async function initFirebase() {
            const authStatusLine = document.getElementById('authStatusLine');

            // Cek apakah konfigurasi sudah diganti.
            if (firebaseConfig.apiKey === "YOUR_API_KEY_HERE") {
                const errorMsg = "[$ FATAL ERROR] Konfigurasi Firebase belum diisi. Ganti nilai di file index.html.";
                console.error(errorMsg);
                authStatusLine.innerHTML = `[$ SYSTEM] <span class="text-red-500">${errorMsg}</span>`;
                showMessageBox("[$ ERROR] Konfigurasi Hilang", "Mohon ganti `YOUR_API_KEY_HERE` dan nilai konfigurasi Firebase lainnya di dalam tag `<script>` file `index.html`.", false);
                return;
            }

            try {
                // Inisiasi Firebase
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                authStatusLine.innerHTML = '[$ SYSTEM] <span class="text-yellow-500">Mengautentikasi (Anonymous)...</span>';

                // Set persistensi sesi browser
                await setPersistence(auth, browserSessionPersistence);

                // Menggunakan signInAnonymously karena initialAuthToken tidak ada di Vercel
                await signInAnonymously(auth);

                // Get unique user ID
                userId = auth.currentUser?.uid || crypto.randomUUID();
                document.getElementById('displayUserId').textContent = userId;

                authStatusLine.innerHTML = '[$ SYSTEM] <span class="text-cyan-500">Otentikasi OK. ID dimuat.</span>';
                console.log("Firebase Auth OK. User ID Anda:", userId);

                // Initialize Firestore Listener
                setupPremiumStatusListener();

                // Check if current user is admin and show the panel
                if (userId === ADMIN_USER_ID) {
                    document.getElementById('adminPanel').classList.remove('hidden');
                    console.log("Mode Admin Aktif.");
                } else {
                    document.getElementById('adminPanel').classList.add('hidden');
                    console.log("Mode User Biasa Aktif.");
                }

            } catch (error) {
                // Penanganan Error Umum Inisiasi Firebase
                console.error("Firebase Auth/Init Error: Gagal menginisiasi Firebase:", error);
                authStatusLine.innerHTML = '[$ SYSTEM] <span class="text-red-500">AUTH FAILED: Sistem tidak dapat dimuat.</span>';

                let displayError = `Gagal memuat sistem autentikasi/database. (Kode: ${error.code || 'UNKNOWN'}). Pastikan API Key dan Project ID sudah benar.`;

                showMessageBox("[$ ERROR] Auth System Failed", displayError, false);
            }
        }

        // --- Firestore Premium Status Listener ---
        function setupPremiumStatusListener() {
            if (!db || userId === 'USER_ID_BELUM_SIAP') return;

            unsubscribePremiumStatus();

            unsubscribePremiumStatus = onSnapshot(getPremiumStatusPath(userId), (docSnapshot) => {
                if (docSnapshot.exists()) {
                    const data = docSnapshot.data();
                    isPremium = data.isPremium === true;
                } else {
                    isPremium = false;
                }
                updatePremiumStatusUI();
            }, (error) => {
                console.error("Error listening to premium status:", error);
                isPremium = false;
                updatePremiumStatusUI();
            });
        }

        // --- Tone.js Setup for Sound Effects ---
        const soundToggle = document.getElementById('soundToggle');
        const soundIndicator = document.querySelector('.toggle-circle');
        let isSoundOn = soundToggle.checked;

        let synth = null;
        try {
            if (Tone) {
                // Mengurangi latency
                Tone.context.lookAhead = 0.05;
                synth = new Tone.MembraneSynth().toDestination();
                synth.volume.value = -10;
            }
        } catch (e) {
            console.warn("Tone.js failed to initialize:", e);
        }

        function playKeySound() {
            if (isSoundOn && synth) {
                synth.triggerAttackRelease("C3", "64n");
            }
        }

        function playSystemSound() {
            if (isSoundOn && synth) {
                synth.triggerAttackRelease("A4", "8n");
                synth.triggerAttackRelease("C5", "8n", "+0.1");
            }
        }

        // Toggle Sound Logic
        soundToggle.addEventListener('change', () => {
            isSoundOn = soundToggle.checked;
            soundIndicator.classList.toggle('translate-x-3');
            soundIndicator.classList.toggle('translate-x-0');
            document.getElementById('soundIndicator').classList.toggle('bg-green-500');
            document.getElementById('soundIndicator').classList.toggle('bg-gray-500');
            if (isSoundOn) {
                if (Tone && Tone.context.state !== 'running') {
                    Tone.start().then(() => playSystemSound());
                } else {
                    playSystemSound();
                }
            }
        });

        // --- Message Box Handlers (Custom implementation) ---
        const messageBox = document.getElementById('messageBox');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');
        const messageActions = document.getElementById('messageActions');
        const closeMessageBox = document.getElementById('closeMessageBox');

        closeMessageBox.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });

        function showMessageBox(title, htmlContent, isSuccess = false, actions = []) {
            messageTitle.textContent = title;
            messageText.innerHTML = htmlContent;

            messageActions.innerHTML = '';
            messageActions.appendChild(closeMessageBox);
            actions.forEach(action => messageActions.appendChild(action));

            messageBox.classList.remove('hidden');

            const boxDiv = messageBox.querySelector('div');
            if (isSuccess) {
                boxDiv.classList.remove('border-red-500');
                boxDiv.classList.add('border-green-500');
                messageTitle.classList.remove('text-red-500');
                messageTitle.classList.add('text-neon');
                playSystemSound();
            } else {
                boxDiv.classList.remove('border-green-500');
                boxDiv.classList.add('border-red-500');
                messageTitle.classList.remove('text-neon');
                messageTitle.classList.add('text-red-500');
            }
        }

        // --- UI Updates for Premium Status ---
        const premiumBadge = document.getElementById('premiumBadge');
        const premiumButton = document.getElementById('premiumButton');
        const premiumSection = document.getElementById('premiumSection');
        const currentStatusText = document.getElementById('currentStatusText');

        function updatePremiumStatusUI() {
            if (isPremium) {
                premiumBadge.classList.remove('hidden');
                premiumButton.textContent = '[$ STATUS] ALPHA-7 AKTIF';
                premiumButton.classList.remove('bg-red-700', 'hover:bg-red-500', 'shadow-red-700/50');
                premiumButton.classList.add('bg-green-600', 'hover:bg-green-400', 'shadow-green-600/50');
                premiumButton.disabled = true;
                premiumSection.classList.remove('border-green-900', 'shadow-green-900/50');
                premiumSection.classList.add('border-yellow-600', 'shadow-yellow-600/50');
                currentStatusText.textContent = 'AKTIF (Member Premium)';
                currentStatusText.classList.remove('text-red-500');
                currentStatusText.classList.add('text-green-500');
            } else {
                premiumBadge.classList.add('hidden');
                premiumButton.textContent = 'AKTIFKAN ALPHA-7 (QRIS & Admin Confirm)';
                premiumButton.classList.add('bg-red-700', 'hover:bg-red-500', 'shadow-red-700/50');
                premiumButton.classList.remove('bg-green-600', 'hover:bg-green-400', 'shadow-green-600/50');
                premiumButton.disabled = false;
                premiumSection.classList.add('border-green-900', 'shadow-green-900/50');
                premiumSection.classList.remove('border-yellow-600', 'shadow-yellow-600/50');
                currentStatusText.textContent = 'NON-AKTIF (Member Biasa)';
                currentStatusText.classList.add('text-red-500');
                currentStatusText.classList.remove('text-green-500');
            }
        }

        // --- Core Logic (Typing & Data) ---
        const outputDiv = document.getElementById('terminalOutput');
        const searchButton = document.getElementById('searchButton');
        const targetInput = document.getElementById('targetInput');
        const errorMessage = document.getElementById('error-message');

        function typeLine(text, delay = 50) {
            return new Promise(resolve => {
                const line = document.createElement('p');
                outputDiv.appendChild(line);

                let i = 0;
                const cursor = document.createElement('span');
                cursor.className = 'typing-cursor';
                line.appendChild(cursor);

                const interval = setInterval(() => {
                    if (i < text.length) {
                        const char = text.charAt(i);
                        line.insertBefore(document.createTextNode(char), cursor);
                        playKeySound();
                        i++;
                        outputDiv.scrollTop = outputDiv.scrollHeight;
                    } else {
                        clearInterval(interval);
                        line.removeChild(cursor);
                        resolve();
                    }
                }, delay);
            });
        }

        // --- Dynamic Data Generator (DIPERBARUI AGAR SANGAT REALISTIS) ---
        function generateFictionalData(inputQuery, searchType) {
            // Seed based on input for consistent results per query
            let seed = 0;
            for (let i = 0; i < inputQuery.length; i++) {
                seed += inputQuery.charCodeAt(i);
            }
            // Use current time as secondary seed for slight variation
            const timeSeed = new Date().getMinutes() * 60 + new Date().getSeconds();
            seed = (seed + timeSeed) % 10000;

            const hash = (seed * 997) % 1000; // Prime number multiplier for better distribution

            // Normalisasi Kueri
            const normalizedQuery = inputQuery.replace(/[^a-zA-Z0-9\s+@.]/g, '').trim();
            let queryPart = normalizedQuery.split(/\s+/)[0] || 'Anonim';

            // Elemen Realistis Indonesia
            const provinces = ['DKI Jakarta', 'Jawa Barat', 'Banten', 'Jawa Timur', 'Sumatera Utara', 'Jawa Tengah', 'Sulawesi Selatan'];
            const cities = {
                'DKI Jakarta': ['Jakarta Selatan', 'Jakarta Timur', 'Jakarta Barat', 'Jakarta Pusat', 'Jakarta Utara'],
                'Jawa Barat': ['Bandung', 'Bekasi', 'Depok', 'Bogor', 'Cirebon'],
                'Banten': ['Tangerang', 'Serang', 'Cilegon'],
                'Jawa Timur': ['Surabaya', 'Malang', 'Sidoarjo'],
                'Sumatera Utara': ['Medan', 'Pematangsiantar'],
                'Jawa Tengah': ['Semarang', 'Solo', 'Yogyakarta'],
                'Sulawesi Selatan': ['Makassar']
            };

            const province = provinces[hash % provinces.length];
            const cityList = cities[province] || [province];
            const city = cityList[hash % cityList.length];

            const streetType = ['Jalan Raya', 'Gang', 'Komplek', 'Perumahan', 'Blok'][hash % 5];
            const streetSuffix = ['Indah', 'Permai', 'Mawar', 'Seroja', 'Kencana', 'Damai'][hash % 6];
            const streetName = `${streetType} ${queryPart} ${streetSuffix}`;

            // --- Fiksional Data Generation ---

            let baseNIK = `3201${(hash * 37) % 99999999}00${(hash % 10)}`;
            let basePhone = `+62812${hash % 9}${hash % 10}xxxxxx`;
            let baseEmail = `${queryPart.toLowerCase()}${hash % 10}${hash % 100}@${['gmail.com', 'yahoo.co.id', 'outlook.com'][hash % 3]}`;
            let baseIMEI = `865${hash}00${hash}00${(hash % 100)}**`;
            let baseIP = `103.${hash % 255}.${hash % 255}.${hash % 255}`;
            let basePlate = `B ${1000 + hash} ${String.fromCharCode(65 + (hash % 26))}${String.fromCharCode(65 + (hash % 26))}`;


            // Penyesuaian berdasarkan Search Type (Membuat hasil sangat spesifik)
            switch (searchType) {
                case 'nik':
                    baseNIK = inputQuery.substring(0, 6) + 'xxxxxx' + inputQuery.substring(12, 16);
                    basePlate = `B ${2000 + hash} ${String.fromCharCode(65 + (hash % 26))}${String.fromCharCode(65 + (hash % 26))}`;
                    queryPart = 'SBY';
                    break;
                case 'nomor_hp':
                    basePhone = inputQuery.replace(/[^0-9+]/g, '').replace(/(\d{4})(\d{4})/, '$1xxxx');
                    queryPart = 'WA-USER';
                    break;
                case 'email':
                    baseEmail = inputQuery;
                    queryPart = inputQuery.split('@')[0];
                    break;
                case 'ip':
                    baseIP = inputQuery;
                    queryPart = 'IP-HOST';
                    break;
                case 'plat':
                    basePlate = inputQuery.toUpperCase().replace(/([A-Z]) (\d{1,4}) ([A-Z]{1,3})/, '$1 $2 ****');
                    queryPart = 'MOBIL';
                    break;
            }

            const fullName = (searchType === 'nama') ?
                `${queryPart.toUpperCase()} ${['WIJAYA', 'SANTOSO', 'PUTRI', 'HADI'][hash % 4]} ${String.fromCharCode(65 + (hash % 26))}**` :
                `${queryPart} BIN ${['ALI', 'BUDI', 'JOKO'][hash % 3]}`;

            const phoneCensored = basePhone.replace(/(\d{4})x{6}/, '$1****');


            return {
                fullName: fullName,
                nik: baseNIK.replace(/(\*)/g, 'X').replace(/x/g, 'X'),
                kk: baseNIK.replace(/(\*)/g, 'Y').replace(/x/g, 'Y'),
                phone: phoneCensored,
                email: baseEmail.replace(/x/g, '*'),
                plat: basePlate.replace(/x/g, '*'),
                imei: baseIMEI.replace(/x/g, '*'),
                ipAddress: baseIP.replace(/x/g, '*'),
                // Alamat dibuat sangat detail dan realistis
                addressKTP: `Jalan ${['Setiabudi', 'Sudirman', 'Gatot Subroto'][hash % 3]} No. ${hash % 100}, RT 0${hash % 9}/ RW 0${hash % 5}, Kel. D****** A****, Kec. T****** M****, ${city}, ${province}`,
                addressCurrent: `${streetName} No. ${hash % 10}, RT 0${hash % 9 + 1}/ RW 0${hash % 5 + 1}, ${city}, ${province} <span class="text-red-500">[Cek 48 Jam Lalu]</span>`,
                realtimeLocation: `GPS Koordinat (Approx): S 6.2${hash % 9}${hash % 9} E 106.8${hash % 9}${hash % 9} (${city})`,
                device: `Android 1${2 + (hash % 4)} (Xiaomi / Samsung S2${(hash % 5) + 0})`,
                education: [`Universitas ${['Indonesia', 'Brawijaya', 'Gadjah Mada'][hash % 3]} (S1, 20XX)`, `SMAN ${10 + hash % 10} ${city}`],
                jobTitle: ['Staf IT', 'Manajer Pemasaran', 'Data Analyst', 'Wiraswasta'][hash % 4],
                officeName: `PT. ${queryPart.toUpperCase()} Digital Kencana`,
                officeAddress: `Gedung ${['Astra', 'Equity', 'Cyber'][hash % 3]} Tower Lantai 1${hash % 10}, Jakarta Selatan, DKI Jakarta`,
                socmed: [`IG: ${queryPart.toLowerCase()}_***`, `FB: ${queryPart.toLowerCase()}***`, `TG: ${queryPart.toLowerCase()}_osint`],
                hangout: [`Restoran Mewah (3 Hari Lalu)`, `Kantor Pos Pusat ${city} (1 Hari Lalu)`],
            };
        }

        async function generateFakeResult(inputQuery) {
            // Jeda Waktu (Slow/Fast)
            const slowDelayMs = 200; // Delay per baris untuk efek mengetik
            const fastDelayMs = 50;
            
            // Waktu Proses TUNDA (Delay for user waiting)
            const waitTimeMs = isPremium ? 500 : 300000; // 500ms vs 300,000ms (5 menit)
            const waitTimeText = isPremium ? "1 - 5 Detik" : "5 Menit"; 
            const typingDelay = isPremium ? fastDelayMs : slowDelayMs;

            const searchType = document.getElementById('searchType').value;
            const data = generateFictionalData(inputQuery, searchType);

            await typeLine(`[$ PROTOCOL] Mengautentikasi kunci akses level 7...`, typingDelay);
            await typeLine(`[$ PROTOCOL] Kueri: ${inputQuery} | Tipe: ${searchType.toUpperCase()}`, typingDelay);
            await typeLine(`[$ PROTOCOL] Menginisiasi modul Dox-Kernel 7.2.x`, typingDelay);
            await typeLine(`[$ PROCESS] Estimasi Waktu Proses: ${waitTimeText} | Mode: ${isPremium ? 'ALPHA-7 PRIORITY' : 'STANDARD LOW-PRIORITY'}.`, 5);
            await typeLine(`[$ PROCESS] Memulai koneksi ke ELINT L5: Database Kependudukan...`, typingDelay);
            await new Promise(r => setTimeout(r, 1000)); // Jeda 1 detik sebelum hit delay panjang
            
            await typeLine(`[$ WAIT] Sesi Proses Data Utama Dimulai. Mohon Tunggu ${waitTimeText} (${waitTimeMs / 1000}s)...`, typingDelay);
            
            // JEDA PANJANG DISINI
            await new Promise(r => setTimeout(r, waitTimeMs));
            
            
            await typeLine(`[$ PROCESS] Koneksi L5 Established. Memvalidasi checksum data...`, typingDelay);
            await typeLine(`[$ PROCESS] Menerima 1.2 GB data terenkripsi...`, typingDelay);
            await typeLine(`[$ RESULT] ** Data Ditemukan & Di-Dekripsi (Level 7) **`, 30);
            await typeLine(`--------------------------------------------------------------------------------`, 5);

            // --- FEATURE DIFFERENTIATION (PENGURANGAN CENSORING UNTUK PREMIUM) ---
            // Member Biasa: Sensor Penuh
            const officeAddressDisplay = isPremium ? data.officeAddress : 'Lokasi Office: ***** [Layer 6 Restricted]';
            const plateDisplay = isPremium ? data.plat : data.plat.substring(0, data.plat.length - 4) + '****'; // Sensor 4 karakter terakhir plat
            const emailDisplay = isPremium ? data.email : data.email.replace(/@\w+\.\w+/, '@****.***');
            const phoneDisplay = isPremium ? data.phone.replace(/x/g, '*') : data.phone.replace(/(\d{4})x{6}/, '$1****'); // Sensor 6 digit terakhir HP
            // ----------------------------------------------------------------------


            const lines = [
                `> NIK KTP: <span class="text-yellow-400">${data.nik}</span> (Sumber: L5-Dukcapil)`,
                `> Kartu Keluarga (KK): <span class="text-yellow-400">${data.kk}</span>`,
                `> Nama Lengkap: <span class="text-cyan-400">${data.fullName}</span> (BIN: ${data.fullName.split(' ')[data.fullName.split(' ').length - 1]})`,
                `> Alamat KTP: ${data.addressKTP}`,
                `> Alamat Saat Ini: ${data.addressCurrent}`,
                `> --- [KONTAK & PERANGKAT] ---`,
                `> Telepon/WA: <span class="text-red-500">${phoneDisplay}</span>`,
                `> Email Utama: ${emailDisplay}`,
                `> IMEI Perangkat: ${data.imei}`,
                `> Alamat IP Terakhir: ${data.ipAddress}`,
                `> Info Perangkat: ${data.device}`,
                `> --- [INFORMASI KEBERADAAN & PEKERJAAN] ---`,
                `> Plat Kendaraan: ${plateDisplay} <span class="text-cyan-400">${isPremium ? '[DEKODE L6]' : ''}</span>`,
                `> Lokasi GPS Real Time: ${data.realtimeLocation}`,
                `> Pekerjaan: ${data.jobTitle} di ${data.officeName}`,
                `> Lokasi Kantor: ${officeAddressDisplay}`,
                `> Sosial Media Dideteksi: ${data.socmed.join(' | ')}`,
                `--------------------------------------------------------------------------------`,
                `[$ SUCCESS] ** Prosedur Data-Doxing Selesai. **`,
                `[$ SYSTEM] Siap menerima Kueri Baru.`
            ];

            for (const line of lines) {
                await typeLine(line, line.includes('SUCCESS') ? 100 : 15);
            }

            playSystemSound();
            searchButton.disabled = false;
        }

        // --- Event Handlers ---

        // Main Search Handler
        searchButton.addEventListener('click', async () => {
            const input = targetInput.value.trim();
            const searchType = document.getElementById('searchType').value;

            // Cek jika Firebase belum siap
            if (userId === 'USER_ID_BELUM_SIAP') {
                showMessageBox("[$ WARNING] Sistem Belum Siap", "Autentikasi Firebase belum selesai. Mohon tunggu sejenak hingga 'User ID' muncul.", false);
                return;
            }

            if (input === '') {
                errorMessage.classList.remove('hidden');
                outputDiv.scrollTop = outputDiv.scrollHeight;
                return;
            }
            errorMessage.classList.add('hidden');

            searchButton.disabled = true;
            outputDiv.innerHTML = '';
            outputDiv.appendChild(document.createElement('br'));

            await typeLine(`[$ RUN] Menginisiasi pencarian data...`, 15);
            await typeLine(`[$ TARGET] Kueri: ${input} (${searchType.toUpperCase()})`, 15);

            await generateFakeResult(input);
        });

        // Premium Button Handler (USER INSTRUCTION)
        premiumButton.addEventListener('click', () => {

            // HTML content for payment instructions
            const instructionsHtml = `
            <h4 class="text-lg font-bold text-neon mb-4">Langkah-Langkah Konfirmasi Pembayaran</h4>
            
            <p class="text-sm mb-4 text-left">
                1. Lakukan pembayaran **Rp 399.000** (+ Gratis 1 Bulan) melalui **QRIS** di bawah ini:
            </p>
            
            <div class="flex justify-center mb-4 p-2 bg-white rounded-md">
                <img src="qris.jpg" alt="QRIS Placeholder" class="w-48 h-48 border-2 border-green-500 rounded-md">
            </div>

            <p class="text-xs text-center text-gray-500 mb-4">
                (Gunakan aplikasi pembayaran Anda yang mendukung QRIS. Pastikan jumlahnya tepat.)
            </p>

            <p class="text-sm mb-2 text-left text-yellow-500">
                **LANGKAH KONFIRMASI WAJIB (Admin Verifikasi):**
            </p>
            <p class="text-sm mb-4 text-left">
                2. Setelah transfer, kirimkan **bukti pembayaran** (screenshot) dan **USER ID Anda** (tertera di bawah) ke kontak Admin kami melalui Telegram: 
                <a href="https://t.me/Youghoz" target="_blank" class="text-cyan-400 hover:text-cyan-200 font-bold">@Youghoz</a>
            </p>
            <p class="text-sm mb-2 text-left">
                3. User ID Anda (WAJIB disertakan):
            </p>
            <div class="user-id-display text-left">
                <span class="text-red-500 font-bold">${userId}</span>
            </div>
            <p class="text-xs mt-4 text-gray-500">
                Status Premium akan aktif setelah **Admin memverifikasi** pembayaran dan User ID Anda. Proses Verifikasi Admin: 1-5 Menit.
            </p>
        `;

            showMessageBox(
                "[[ ALPHA-7 PAYMENT VIA QRIS & TELEGRAM ]]",
                instructionsHtml,
                false
            );
        });

        // Admin Panel Logic (ADMIN ACTION)
        document.getElementById('activatePremiumButton').addEventListener('click', async () => {
            const targetUid = document.getElementById('targetUserIdInput').value.trim();
            const adminStatus = document.getElementById('adminStatus');
            adminStatus.classList.remove('hidden');
            adminStatus.textContent = 'Status: Memproses aktivasi Premium...';

            if (!targetUid) {
                adminStatus.textContent = '[$ ERROR] Target User ID tidak boleh kosong. Masukkan ID dari Telegram.';
                adminStatus.classList.remove('text-yellow-400');
                adminStatus.classList.add('text-red-500');
                return;
            }

            // Safety check agar tidak mengaktifkan admin ID itu sendiri
            if (targetUid === ADMIN_USER_ID) {
                adminStatus.textContent = '[$ ERROR] User ID Admin tidak perlu diaktifkan.';
                adminStatus.classList.remove('text-yellow-400');
                adminStatus.classList.add('text-red-500');
                return;
            }

            try {
                // Write premium status to Firestore
                await setDoc(getPremiumStatusPath(targetUid), {
                    isPremium: true,
                    activatedBy: userId, // Log which admin activated it
                    activationDate: new Date().toISOString()
                }, { merge: true });

                adminStatus.textContent = `[$ SUCCESS] User ID ${targetUid.substring(0, 10)}... telah diaktifkan! Status Premium diperbarui. Konfirmasi Selesai.`;
                adminStatus.classList.add('text-green-500');
                adminStatus.classList.remove('text-red-500', 'text-yellow-400');

            } catch (error) {
                console.error("ADMIN ERROR activating premium:", error);
                adminStatus.textContent = `[$ FATAL ERROR] Gagal menyimpan ke database. Cek konsol.`;
                adminStatus.classList.remove('text-yellow-400', 'text-green-500');
                adminStatus.classList.add('text-red-500');
            }
        });

        // --- Initialization on Load ---
        window.onload = () => {
            initFirebase();

            // Mengganti listener ini untuk mengatasi masalah Tone.js di sebagian besar browser
            document.body.addEventListener('click', () => {
                if (Tone && Tone.context.state !== 'running') {
                    Tone.start();
                }
            }, { once: true });

            // Initial setup for the sound toggle indicator
            if (isSoundOn) {
                soundIndicator.classList.add('translate-x-3');
                document.getElementById('soundIndicator').classList.add('bg-green-500');
            } else {
                soundIndicator.classList.add('translate-x-0');
                document.getElementById('soundIndicator').classList.add('bg-gray-500');
            }
        }
    </script>

</body>

</html>
